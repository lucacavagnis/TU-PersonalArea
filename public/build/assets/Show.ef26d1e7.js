import{j as l,a as e,F as n,u as T,H as P,d as k,L as F,r as I}from"./app.aa1f3dfb.js";import{A as z,C as H}from"./AuthenticatedLayout.a7927cd3.js";import{T as y}from"./Tab.10118ec5.js";import{R as v}from"./ReservedPrice.75468681.js";import{P as L}from"./ProductImage.b8f2e0d1.js";import{T as g}from"./TextInput.df6004f3.js";import{B as m}from"./Button.cff7c94a.js";import{q as j,l as D,i as p,a as E}from"./Product.2753c164.js";import{T as s}from"./Table.3dfc2dee.js";import{a as R}from"./String.db95b830.js";import{A as S}from"./ApplicationLogo.cf36f3b5.js";import{i as A,j as B}from"./transition.50b0d3ea.js";import"./tw-merge.25811ea8.js";import"./Pagination.a29522d9.js";import"./index.esm.00ca2219.js";function O({total:a,partial:t,size:r="big"}){return l("div",{className:"mb-4",children:[r==="small"?l("span",{className:j(t,a)+" font-bold text-sm uppercase",children:[t," di ",a]}):l("h3",{className:"uppercase font-bold mb-2",children:[e("span",{className:D(t,a)+" h-3 w-3 inline-block rounded-full mr-2"}),l("span",{className:"align-middle",children:[t," disponibile su ",a]})]}),e("div",{className:"w-full h-2 rounded bg-slate-200 relative",children:e("div",{className:" h-full absolute left-0 bg-emerald-700 rounded",style:{width:t/a*100+"%"}})})]})}const U=({isInWarehouse:a,extended:t})=>e(n,{children:a&&l("div",{className:"flex  mr-2 items-center",children:[e(S,{className:"w-4"}),t&&e("span",{className:"ml-2",children:"Pronta consegna"})]})}),M=({isPayed:a,extended:t})=>e(n,{children:e("div",{className:"flex  mr-2 items-center",children:a?l(n,{children:[e(B,{className:"text-slate-700"}),t&&e("span",{className:"ml-2",children:"Gi\xE0 fatturato"})]}):l(n,{children:[e(A,{className:"text-slate-700"}),t&&e("span",{className:"ml-2",children:"Da fatturare"})]})})});function Q({lot:a,extended:t=!1}){return l("div",{className:"flex mb-2 group",children:[e(U,{isInWarehouse:!1,extended:t}),e(M,{isPayed:a.protocol_lot&&a.protocol_lot.protocol&&a.protocol_lot.protocol.type,extended:t})]})}function me(a){const t=a.product;let r=!1;const o=()=>{k.Inertia.post(route("products.quotation",t.id),{},{onStart:()=>{r=!0},onFinish:()=>{r=!1}})},{data:d,setData:f,post:N,reset:q}=T({product_id:t.id,qty:0}),_=(i,c)=>{i.preventDefault(),N(route("cart.store"),{preserveScroll:!0,onSuccess:()=>{q(),c()}})},x=i=>{i.preventDefault(),f(i.target.name.split("-")[0],d[i.target.name.split("-")[0]].map((c,w)=>w===parseInt(i.target.name.split("-")[1])?{id:c.id,qty:parseInt(i.target.value)}:c))},C=i=>{i.preventDefault(),f(i.target.name,parseInt(i.target.value))};let h=[],u=[];return t.lots.forEach((i,c)=>{console.log(i.qty_available-i.qty_requested),i.qty_available-i.qty_requested>0?h.push(e(W,{lot:i,data:d,id:c,onChange:x})):u.push(e(G,{product:i}))}),e("div",{children:l(z,{auth:a.auth,errors:a.errors,header:a.product.name,children:[e(P,{children:e("title",{children:a.product.name})}),e("div",{className:"py-12",children:l("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e(V,{product:t,children:t.qty_available-t.qty_requested>0?l(n,{children:[l("div",{className:"flex items-center mt-2",children:[e(g,{name:"qty",value:d.qty,type:"number",min:0,max:t.qty_available-t.qty_requested,handleChange:i=>C(i),className:"mr-4"}),e("p",{className:"font-bold",children:"/ "+(t.qty_available-t.qty_requested)+" disponibili"})]}),l("div",{className:"flex items-center",children:[e(K,{className:"mr-2",submit:_}),e(m,{disbaled:r,pending:r,type:"button",kind:"primary",onClick:o,children:"Richiedi nuova qutazione"})]})]}):l("div",{children:[e("p",{className:"font-bold text-lg text-red-700",children:"Esaurito / Disponibilit\xE0 da verificare"}),e(m,{disbaled:r,pending:r,type:"button",kind:"primary",onClick:o,children:"Richiedi nuova quotazione"})]})}),l("div",{className:"flex justify-between",id:"warehouse",children:[e(b,{title:"Lotti in magazzino",position:"first",children:h.length===0?e("p",{children:"Prodotto non presente in magazzino"}):e(n,{children:h})}),e(b,{title:"Storico lotti",position:"second",children:e(J,{children:u.length===0?e("p",{children:"Prodotto non presente in storico"}):u})})]})]})})]})})}const V=({children:a,product:t})=>l(y,{className:"flex justify-between w-full mb-4",children:[e("div",{className:"w-1/2 mr-4 relative",children:e(L,{name:t.image,className:"h-full"})}),e("div",{className:"w-1/2 ml-4",children:l("div",{className:"mb-8",children:[e("span",{className:"mb-2 block",children:t.sku}),e("h1",{className:"font-bold hover:underline",children:e(F,{href:route("products.show",t.id),children:t.name})}),t.last_price&&l("div",{className:"mb-4 flex items-baseline",children:[e(v,{fullPrice:t.qty_available-t.qty_requested>0?t.last_original_price:null,reservedPrice:t.qty_available-t.qty_requested?t.last_price:t.last_original_price,className:"text-lg mr-2"}),t.qty_available-t.qty_requested>0&&e("p",{className:"text-sm text-gray-500",children:"Ultima quotazione"})]}),e("p",{className:"uppercase font-semibold mb-4 text-slate-500 text-sm",children:t.category.name+" / "+t.subcategory.name}),e("p",{className:"mb-4",children:t.desc}),a]})})]}),W=({lot:a})=>{const t=a;return e("div",{className:"mb-4 border-b pb-2",children:l("div",{className:"flex justify-between",children:[l("div",{className:"min-w-[50%]",children:[e(Q,{lot:a,extended:!0}),e(O,{partial:t.qty_available-t.qty_requested,total:t.qty_total,size:"small"})]}),l("div",{className:"text-right",children:[e("span",{className:"text-sm text-slate-700",children:R(t.date)}),a.protocol_lot&&e(n,{children:e(m,{kind:"tertiary",href:route("protocols.show",a.protocol_lot.protocol_id),className:"flex align-items-center",children:"Vedi protocollo"})})]})]})})},G=({product:a})=>{const t="[&>*]:py-4";return l(s.Row,{className:"border-b border-slate-100 text-sm "+t,children:[e(s.Field,{children:p(a)?"Tutto Ufficio":"Terzi"}),e(s.Field,{children:E(a)?"Conto aperto":"Conto deposito"}),e(s.Field,{children:a.qty_total}),e(s.Field,{children:p(a)&&e(m,{type:"link",kind:"tertiary",href:route("protocols.show",a.protocol_lot.protocol.id),className:"mt-0 align-middle",children:"Vedi protocollo"})})]},a.id)},J=({children:a})=>e(s,{children:l(s.Inner,{children:[l(s.HeaderRow,{children:[e(s.Header,{children:"Fornitore"}),e(s.Header,{children:"Tipo"}),e(s.Header,{children:"Q.t\xE0"}),e(s.Header,{})]}),e(s.Body,{children:a})]})}),b=({title:a,children:t,position:r})=>e(y,{containerClassName:(r==="first"?"mr-2":"ml-2")+" w-1/2",children:l("div",{children:[e("h2",{className:"font-bold mb-4",children:a}),t]})}),K=({submit:a,className:t})=>{const{openCart:r}=I.exports.useContext(H);return e(m,{type:"submit",className:t,onClick:o=>{a(o,r)},children:"Aggiungi al carrello"})},he=({name:a,product:t,qty:r,onChange:o})=>l("div",{children:[p(t)&&e(v,{reservedPrice:t.protocol_product.price,fullPrice:t.protocol_product.original_price}),l("div",{className:"flex items-center",children:[e(g,{name:a,value:r,type:"number",min:0,max:t.qty_available-t.qty_requested,handleChange:d=>o(d),className:"mr-4"}),e("span",{className:"text-lg font-bold",children:"di "+(t.qty_available-t.qty_requested)+" disponibili"})]})]});export{he as BuyInput,K as CartButton,V as ProductDataTab,me as default};
