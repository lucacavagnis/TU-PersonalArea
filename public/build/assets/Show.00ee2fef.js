import{j as i,a as e,u as P,H as k,F as b,d as z,L as F,r as H}from"./app.701c8412.js";import{A as D,C as I}from"./AuthenticatedLayout.c6eeb50b.js";import{T as v}from"./Tab.c8dc8a01.js";import{R as g}from"./ReservedPrice.432d9723.js";import{P as R}from"./ProductImage.9596a1e1.js";import{T as q}from"./TextInput.404c8393.js";import{B as c}from"./Button.8e427060.js";import{q as j,l as S,i as m,a as N}from"./Product.2753c164.js";import{T as n}from"./Table.5afe908a.js";import{a as B}from"./String.db95b830.js";import"./ApplicationLogo.195ea916.js";import"./transition.dfaf50e0.js";import"./tw-merge.25811ea8.js";import"./Pagination.02ccbf5e.js";import"./index.esm.e45dea00.js";function E({total:a,partial:t,size:r="big"}){return i("div",{className:"mb-4",children:[r==="small"?i("span",{className:j(t,a)+" font-bold text-sm uppercase",children:[t," di ",a]}):i("h3",{className:"uppercase font-bold mb-2",children:[e("span",{className:S(t,a)+" h-3 w-3 inline-block rounded-full mr-2"}),i("span",{className:"align-middle",children:[t," disponibile su ",a]})]}),e("div",{className:"w-full h-2 rounded bg-slate-200 relative",children:e("div",{className:" h-full absolute left-0 bg-emerald-700 rounded",style:{width:t/a*100+"%"}})})]})}function re(a){console.log(a);const t=a.product;let r=!1;const o=()=>{z.Inertia.post(route("products.quotation",t.id),{},{onStart:()=>{r=!0},onFinish:()=>{r=!1}})},{data:s,setData:h,post:f,reset:x}=P({product_id:t.id,qty:0}),_=(l,d)=>{l.preventDefault(),f(route("cart.store"),{preserveScroll:!0,onSuccess:()=>{x(),d()}})},C=l=>{l.preventDefault(),h(l.target.name.split("-")[0],s[l.target.name.split("-")[0]].map((d,T)=>T===parseInt(l.target.name.split("-")[1])?{id:d.id,qty:parseInt(l.target.value)}:d))},w=l=>{l.preventDefault(),h(l.target.name,parseInt(l.target.value))};let u=[],p=[];return t.lots.forEach((l,d)=>{console.log(l.qty_available-l.qty_requested),l.qty_available-l.qty_requested>0?u.push(e(L,{lot:l,data:s,id:d,onChange:C})):p.push(e(U,{product:l}))}),e("div",{children:i(D,{auth:a.auth,errors:a.errors,header:a.product.name,children:[e(k,{children:e("title",{children:a.product.name})}),e("div",{className:"py-12",children:i("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e(A,{product:t,children:t.qty_available-t.qty_requested>0?i(b,{children:[i("div",{className:"flex items-center mt-2",children:[e(q,{name:"qty",value:s.qty,type:"number",min:0,max:t.qty_available-t.qty_requested,handleChange:l=>w(l),className:"mr-4"}),e("p",{className:"font-bold",children:"/ "+(t.qty_available-t.qty_requested)+" disponibili"})]}),i("div",{className:"flex items-center",children:[e(V,{className:"mr-2",submit:_}),e(c,{disbaled:r,pending:r,type:"button",kind:"primary",onClick:o,children:"Richiedi nuova qutazione"})]})]}):i("div",{children:[e("p",{className:"font-bold text-lg text-red-700",children:"Esaurito / Disponibilit\xE0 da verificare"}),e(c,{disbaled:r,pending:r,type:"button",kind:"primary",onClick:o,children:"Richiedi nuova quotazione"})]})}),i("div",{className:"flex justify-between",id:"warehouse",children:[e(y,{title:"Lotti in magazzino",position:"first",children:u.length===0?e("p",{children:"Prodotto non presente in magazzino"}):e(b,{children:u})}),e(y,{title:"Storico lotti",position:"second",children:e(Q,{children:p.length===0?e("p",{children:"Prodotto non presente in storico"}):p})})]})]})})]})})}const A=({children:a,product:t,data:r,onChange:o,submit:s,processing:h,onClick:f})=>i(v,{className:"flex justify-between w-full mb-4",children:[e("div",{className:"w-1/2 mr-4 relative",children:e(R,{name:t.image,className:"h-full"})}),e("div",{className:"w-1/2 ml-4",children:i("div",{className:"mb-8",children:[e("span",{className:"mb-2 block",children:t.sku}),e("h1",{className:"font-bold hover:underline",children:e(F,{href:route("products.show",t.id),children:t.name})}),t.last_price&&i("div",{className:"mb-4 flex items-baseline",children:[e(g,{fullPrice:t.qty_available-t.qty_requested>0?t.last_original_price:null,reservedPrice:t.qty_available-t.qty_requested?t.last_price:t.last_original_price,className:"text-lg mr-2"}),t.qty_available-t.qty_requested>0&&e("p",{className:"text-sm text-gray-500",children:"Ultima quotazione"})]}),e("p",{className:"uppercase font-semibold mb-4 text-slate-500 text-sm",children:t.category.name+" / "+t.subcategory.name}),e("p",{className:"mb-4",children:t.desc}),a]})})]}),L=({id:a,lot:t,data:r,onChange:o})=>{const s=t;return e("div",{className:"mb-4 border-b pb-2",children:i("div",{className:"flex justify-between",children:[i("div",{className:"min-w-[50%]",children:[e("span",{className:"text-xs text-slate-400 uppercase",children:m(s)?"Da Tutto Ufficio":"Da terzi"}),e("p",{children:N(s)?"Conto aperto":"Conto deposito"}),e(E,{partial:s.qty_available-s.qty_requested,total:s.qty_total,size:"small"})]}),i("div",{className:"text-right",children:[e("span",{className:"text-sm text-slate-700",children:B(s.date)}),t.protocol_lot&&e(b,{children:e(c,{kind:"tertiary",href:route("protocols.show",t.protocol_lot.protocol_id),className:"flex align-items-center",children:"Vedi protocollo"})})]})]})})},U=({product:a})=>{const t="[&>*]:py-4";return i(n.Row,{className:"border-b border-slate-100 text-sm "+t,children:[e(n.Field,{children:m(a)?"Tutto Ufficio":"Terzi"}),e(n.Field,{children:N(a)?"Conto aperto":"Conto deposito"}),e(n.Field,{children:a.qty_total}),e(n.Field,{children:m(a)&&e(c,{type:"link",kind:"tertiary",href:route("protocols.show",a.protocol_lot.protocol.id),className:"mt-0 align-middle",children:"Vedi protocollo"})})]},a.id)},Q=({children:a})=>e(n,{children:i(n.Inner,{children:[i(n.HeaderRow,{children:[e(n.Header,{children:"Fornitore"}),e(n.Header,{children:"Tipo"}),e(n.Header,{children:"Q.t\xE0"}),e(n.Header,{})]}),e(n.Body,{children:a})]})}),y=({title:a,children:t,position:r})=>e(v,{containerClassName:(r==="first"?"mr-2":"ml-2")+" w-1/2",children:i("div",{children:[e("h2",{className:"font-bold mb-4",children:a}),t]})}),V=({submit:a,className:t})=>{const{openCart:r}=H.exports.useContext(I);return e(c,{type:"submit",className:t,onClick:o=>{a(o,r)},children:"Aggiungi al carrello"})},se=({name:a,product:t,qty:r,onChange:o})=>i("div",{children:[m(t)&&e(g,{reservedPrice:t.protocol_product.price,fullPrice:t.protocol_product.original_price}),i("div",{className:"flex items-center",children:[e(q,{name:a,value:r,type:"number",min:0,max:t.qty_available-t.qty_requested,handleChange:s=>o(s),className:"mr-4"}),e("span",{className:"text-lg font-bold",children:"di "+(t.qty_available-t.qty_requested)+" disponibili"})]})]});export{se as BuyInput,V as CartButton,A as ProductDataTab,re as default};
