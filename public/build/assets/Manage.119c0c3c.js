import{A as L}from"./AdminLayout.42cbd391.js";import{j as e,F as z,a as i,R as M,d as T,u as F,H as I}from"./app.b45b0f29.js";import{T as w}from"./Tab.0b6397fc.js";import{B as E}from"./Box.e91327fa.js";import{h,e as N,A as O,k}from"./InputAdornment.6d6322eb.js";import{F as S}from"./FormGroup.1955b3e8.js";import{S as A}from"./Switch.d95e7e75.js";import{B as g}from"./ClickAwayListener.f3b4c51a.js";import{a as y}from"./Close.d844cfd9.js";import{D as Y,a as H,b as R,c as B,d as G}from"./DialogTitle.ca78273b.js";import{P as V}from"./ProductImage.a5603c41.js";import{h as P}from"./moment.9709ab41.js";import{S as j,A as Q}from"./Alert.37c8ab48.js";import"./ApplicationLogo.bbdd66d7.js";import"./transition.54d2eece.js";import"./tw-merge.25811ea8.js";import"./BackgorundImage.d3e17cbc.js";const Z=y(e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),$=y(e("path",{d:"M18.3 5.71a.9959.9959 0 0 0-1.41 0L12 10.59 7.11 5.7a.9959.9959 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"}),"CloseRounded"),J=y(e("path",{d:"M7 11v2h10v-2H7zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"RemoveCircleOutline"),K=y(e("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save"),U=({id:o,lot:a,protocols:u,update:p,remove:d,error:l})=>{const v={slot:{rack:"",shelf:"",pallet:""},qty:0},r=t=>{const n={...a};n[t.target.name]=t.target.type==="checkbox"?t.target.checked:t.target.value,p(o,n)},m=t=>{const n={...a};n.protocol_lot[t.target.name]=t.target.type==="checkbox"?t.target.checked:t.target.value,p(o,n)},x=(t,n)=>{const s={...a};s.protocol_lot?(s.protocol_lot.protocol_id=n.id,s.protocol_lot.protocol=n):s.protocol_lot={protocol_id:n.id,protocol:n},p(o,s)},f=()=>{let t=a.locations;t?t.push(v):t=[v],p(o,{...a,locations:t})},C=t=>{const n=a.locations,s=n.splice(t,1);s[0].id&&T.Inertia.delete(route("admin.lots.location.destroy",s[0].id)),p(t,{...a,slots:n})},c=t=>{const n=a.locations,s=t.target.name.split("-")[0],b=t.target.name.split("-")[1];n.map((q,D)=>(D==s&&(b==="qty"?q.qty=t.target.value:q.slot[b]=t.target.value),q)),p(s,{...a,locations:n})};return e(z,{children:e(w,{containerClassName:"mb-4 relative",children:i(E,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"25ch"},"& .MuiOutlinedInput-input":{boxShadow:"none"},"& > div":{my:"1em"}},noValidate:!0,autoComplete:"off",children:[e(X,{remove:()=>d(o)}),i("div",{children:[i("div",{className:"flex mb-8",children:[e(h,{id:"qty-available",label:"Qt.\xE0 disponibile",name:"qty_available",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:0,max:a.qty_total},onChange:t=>r(t),value:a.qty_available,variant:"outlined",required:!0,error:l&&l[o+".qty_available"],helperText:l[o+".qty_available"]}),e(h,{id:"qty-total",label:"Qt.\xE0 totale",name:"qty_total",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:0},type:"number",onChange:t=>r(t),value:a.qty_total,variant:"outlined",required:!0,error:l&&l[o+".qty_total"],helperText:l[o+".qty_total"]}),e(h,{id:"date",label:"Data",name:"date",type:"date",onChange:t=>r(t),value:a.date,variant:"outlined",required:!0,helperText:l?l[o+".date"]:"La data del protcollo o di ricezione",error:l&&l[o+".date"]})]}),i("div",{className:"border-t py-4 my-2",children:[e(S,{children:e(N,{control:e(A,{checked:a.protocol,onChange:t=>r(t),name:"protocol"}),label:"Gestire protocollo?",error:l&&l[o+".protocol"]})}),i("div",{className:(a.protocol?"opacity-1 h-50 py-4":"opacity-0 h-0 pointer-events-none p-0 m-0")+" transition-all",children:[i("div",{className:"flex",children:[e(O,{disablePortal:!0,id:"combo-box-demo",options:u,sx:{width:300},renderInput:t=>e(h,{...t,label:"Protocollo",name:"referral",error:l&&l[o+".protocol_lot.protocol_id"],helperText:l[o+".protocol_lot.protocol_id"]}),onChange:(t,n)=>x(t,n),value:a.protocol_lot?a.protocol_lot.protocol:null,isOptionEqualToValue:(t,n)=>_.isEqual(t,n),getOptionLabel:t=>t.referral}),e(h,{id:"original_price",label:"Prezzo",name:"original_price",type:"number",InputProps:{startAdornment:e(k,{position:"start",children:"\u20AC"})},inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:0},onChange:t=>m(t),value:a.protocol_lot?a.protocol_lot.original_price:null,variant:"outlined",required:!0,error:l&&l[o+".protocol_lot.original_price"],helperText:l[o+".protocol_lot.original_price"]}),e(h,{className:(a.discount?"opacity-1":"opacity-0 pointer-events-none")+" transition-all border-t",id:"price",label:"Prezzo scontato",name:"price",type:"number",InputProps:{startAdornment:e(k,{position:"start",children:"\u20AC"})},inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:0,max:a.protocol_lot?a.protocol_lot.original_price:0},onChange:t=>m(t),value:a.protocol_lot?a.protocol_lot.price:null,variant:"outlined",required:!0,startAdornment:e(k,{position:"start",children:"$"}),helperText:l?l[o+".protocol_lot.price"]:"Non pu\xF2 superare il prezzo orginale",error:l&&l[o+".protocol_lot.price"]})]}),e("div",{className:"flex",children:e(S,{className:"mt-4",children:e(N,{control:e(A,{checked:a.discount,onChange:t=>r(t),name:"discount"}),label:"Applicare sconto?",labelPlacement:"end",error:l&&l[o+".discount"]})})})]})]}),i("div",{className:"border-t py-4 my-2",children:[e(S,{children:e(N,{control:e(A,{checked:a.warehouse,onChange:t=>r(t),name:"warehouse"}),label:"Gestire magazzino?",error:l&&l[o+".warehouse"]})}),i("div",{className:(a.warehouse?"opacity-1 py-4":"opacity-0 h-0 pointer-events-none p-0 m-0")+" transition-all",children:[e(g,{variant:"text",onClick:()=>f(),children:"Aggiungi slot"}),a.locations&&a.locations.map((t,n)=>e(W,{id:n,lot_id:o,slot:t.slot,qty:t.qty,remove:C,update:c,error:l,max:(()=>{let s=a.qty_available;return a.locations.forEach(b=>{s-=b.qty}),s+=Number(a.locations[n].qty),s})()}))]})]})]})]})},o)})},W=({id:o,lot_id:a,qty:u,slot:p,remove:d,update:l,max:v,error:r})=>i("div",{className:"relative py-8",children:[i("div",{className:"flex",children:[e(h,{id:"rack",label:"Armadio",name:o+"-rack",inputProps:{pattern:"[A-Z+]"},onChange:m=>l(m),value:p.rack,variant:"outlined",required:!0,error:r&&r[a+".locations."+o+".slot.rack"],helperText:r[a+".locations."+o+".slot.rack"]}),e(h,{id:"shelf",label:"Scaffale",name:o+"-shelf",inputProps:{pattern:"[1-9+]"},onChange:m=>l(m),value:p.shelf,variant:"outlined",required:!0,error:r&&r[a+".locations."+o+".slot.shelf"],helperText:r[a+".locations."+o+".slot.shelf"]}),e(h,{id:"pallet",label:"Bancale",name:o+"-pallet",inputProps:{pattern:"[1-9+]"},onChange:m=>l(m),value:p.pallet,variant:"outlined",required:!0,error:r&&r[a+".locations."+o+".slot.pallet"],helperText:r[a+".locations."+o+".slot.pallet"]})]}),e(h,{id:"qty",label:"Q.t\xE0",name:o+"-qty",type:"number",inputProps:{inputMode:"numeric",pattern:"[0-9]*",min:0,max:v},onChange:m=>l(m),value:u,variant:"outlined",required:!0,className:"!w-full",error:r&&r[a+".locations."+o+".qty"],helperText:r[a+".locations."+o+".qty"]}),e(J,{className:"absolute top-2 right-2 text-slate-500 hover:cursor-pointer hover:text-red-500 transition-color !text-sm",onClick:()=>d(o)})]},o),X=({remove:o})=>{const[a,u]=M.useState(!1),p=()=>{u(!0)},d=()=>{u(!1)};return i(z,{children:[e($,{className:"absolute top-2 right-2 text-slate-500 hover:cursor-pointer hover:text-red-500 transition-color",fontSize:"small",onClick:p}),i(Y,{open:a,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(H,{id:"alert-dialog-title",children:"Eliminare il lotto?"}),e(R,{children:e(B,{id:"alert-dialog-description",children:"Stai per eliminare il lotto definitivamente, non potrai recuperare pi\xF9 i dati."})}),i(G,{children:[e(g,{onClick:d,children:"Annulla"}),e(g,{sx:{color:"red"},onClick:()=>{d(),o()},autoFocus:!0,children:"Elimina"})]})]})]})};function be(o){const[a,u]=M.useState(null),p=()=>u(null),{data:d,setData:l,post:v,transform:r}=F(o.product.lots.map(c=>(console.log(c),{...c,date:P(c.date).format("YYYY-MM-DD"),protocol:c.protocol_lot!==null,warehouse:c.locations.length!==0,discount:c.protocol_lot!==null&&c.protocol_lot.price!==c.protocol_lot.original_price}))),m=(c,t)=>{const n=[...d];n.splice(c,1,t),l(n)},x=()=>{const c=[...d];c.push({product_id:o.product.id,qty_available:0,date:P().format("YYYY-MM-DD"),qty_total:0,price:0,original_price:0,protocol_lot:{price:0,original_price:0},locations:[],protocol:!1,warehouse:!1,discount:!1}),l(c)},f=c=>{const t=[...d],n=t.splice(c,1);n[0].id&&T.Inertia.delete(route("admin.lots.destroy",n[0].id),{onSuccess:()=>{u({children:"Lotto eliminato",severity:"success"})},onError:s=>{u({children:s.response.data.message,severity:"error"})}}),l(t)},C=()=>{v(route("admin.products.manage.save",o.product.id),{onSuccess:()=>{u({children:"Lotti salvati",severity:"success"})}})};return i(L,{auth:o.auth,errors:o.errors,header:e("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Gestisci lotti"}),breadcrumbs:i("div",{className:"flex items-center",children:[e(g,{href:route("admin.products.index"),className:"!capitalize",children:"Prodotti"}),e("em",{className:"mx-2",children:">"}),e("p",{children:o.product.name})]}),children:[e(I,{title:"Gestisci lotti"}),i("div",{className:"py-12",children:[i("div",{className:"max-w-8xl mx-auto sm:px-6 lg:px-8",children:[i("div",{className:"!mb-4 [&>*:not(:last-child)]:mr-4",children:[e(g,{variant:"contained",endIcon:e(K,{}),onClick:()=>C(),children:"Salva"}),e(g,{variant:"contained",endIcon:e(Z,{}),onClick:()=>x(),children:"Aggiungi lotto"})]}),i("div",{className:"flex",children:[e("div",{className:"mr-4 w-2/3",children:d.length>0?d.map((c,t)=>e(U,{id:t,protocols:o.protocols,lot:c,update:m,remove:f,error:o.errors})):e("p",{children:"Nessun lotto presente"})}),e("div",{className:"relative w-1/3",children:i(w,{containerClassName:"bg-transparent sticky top-4",className:"h-auto",children:[e(V,{name:o.product.image,className:"w-20 h-20"}),e("h3",{className:"uppercase text-blue-700",children:o.product.company.name}),e("h2",{children:o.product.name}),e("p",{children:o.product.desc})]})})]})]}),!!a&&e(j,{open:!0,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:p,autoHideDuration:6e3,children:e(Q,{...a,onClose:p})})]})]})}export{be as default};
